<style>
.share-card {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
    background: #f9f9f9;
}
</style>

<div style="display: flex; flex-direction: column; gap: 20px; margin: 30px 30px 0px 300px;">
     <h2>{{ share.company_name }} ({{ share.share_group_name }})</h2>
    {% for account in accounts %}
        <div class="share-card">
           
            <p><strong>Account Name:</strong> {{ account.name }}</p>
            <p><strong>Demat Number:</strong> {{ account.get_demat }}</p>
            <p><strong>Applied Kitta:</strong> 10 </p>
            <div> <a href="{% url 'apply:apply_now' account.id share.id %}">
                <button 
                    id="applyBtn-{{ account.id }}" 
                    class="applyBtn" 
                    data-user-id="{{ account.id }}" 
                    data-share-id="{{ share.id }}" 
                    disabled>
                    Loading...
                </button> </a>
            </div>
        </div>
    {% empty %}
        <p>No shares available.</p>
    {% endfor %}
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

$(document).ready(async function () {
    const buttons = $(".applyBtn").toArray(); // convert to array for async loop

    for (const btn of buttons) {
        let button = $(btn);
        let userId = button.data("user-id");
        let shareId = button.data("share-id");

        try {
            const data = await $.ajax({
                url: `/apply/check-status/${userId}/${shareId}/`,
                type: "GET",
                dataType: "json",
            });

            console.log(`Status for User ID: ${userId}, Share ID: ${shareId} is ${data.status}`);

            if (data.status === "True") {
                button.prop("disabled", false).text("Apply Now ");
            } else {
                button.prop("disabled", true).text("Applied ");
            }
        } catch (error) {
            button.prop("disabled", true).text("Error ");
        }

        // Sleep 1000ms (1 second) before next iteration
        await sleep(1000);
    }
});
</script>



